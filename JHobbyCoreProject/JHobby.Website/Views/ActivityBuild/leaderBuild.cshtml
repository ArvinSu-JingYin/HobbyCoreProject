@{
    ViewData["Title"] = "團主建團頁面";
}

<partial name="_BreadcrumbPartial" />


<!-- Bootstrap DateTime Picker -->
@* <link rel="stylesheet" href="~/assets/css/bootstrap-datetimepicker.min.css"> *@


<div id="app" class="main-wrapper authendication-pages">
    <div class="content book-cage" data-select2-id="16">
        <div class="container" data-select2-id="15">

            <div class="row" data-select2-id="14">
                <div class="col-12 col-sm-12 col-md-12 col-lg-12" data-select2-id="13">
                    <section class="card booking-form" data-select2-id="12">
                        <h3 class="border-bottom" style="font-size: 35px; text-align: center;">開團內容</h3>
                        <form data-select2-id="11">


                            <div class="mb-3">
                                <label for="date" class="form-label" style="font-size: 22px;">開團名稱</label>
                                <div class="form-icon">
                                    <input type="text" class="form-control" placeholder="請輸入開團名稱" id="empty-field" v-model="activityBuild.activityName">
                                    <span name="ActivityName" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="date" class="form-label" style="font-size: 22px;">開團縣市</label>
                                <div class="form-icon">
                                    <input type="text" class="form-control" placeholder="請輸入正確縣市" id="empty-field" v-model="activityBuild.activityCity">
                                    @* <select2 style="width:100%" :options="cityList" v-model:value="activityBuild.activityCity">
                                    <option disabled value="0">請選擇</option>
                                    </select2> *@
                                    <span name="ActivityCity" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="date" class="form-label" style="font-size: 22px;">開團鄉鎮市區</label>
                                <div class="form-icon">
                                    <input type="text" class="form-control" placeholder="請輸入正確鄉鎮市區" id="empty-field" v-model="activityBuild.activityArea">
                                    @* <select2 style="width:100%" :options="areaList" v-model:value="activityBuild.activityArea">
                                    <option disabled value="1"></option>
                                    </select2> *@           
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="date" class="form-label" style="font-size: 22px;">開團地址</label>
                                <div class="form-icon">
                                    <input type="text" class="form-control" placeholder="請輸入正確地址" id="empty-field" v-model="activityBuild.activityLocation">

                                </div>
                            </div>


                            <div class="mb-3">
                                <label for="date" class="form-label" style="font-size: 22px;">活動開始日期時間</label>
                                <div class="form-icon">
                                    <input type="text" class="form-control " placeholder="請輸入日期時間" v-model="activityBuild.startTime">
                                    <span class="cus-icon">
                                        <i class="feather-calendar icon-date"></i>
                                    </span>
                                </div>
                            </div>



                            <div class="mb-3">
                                <label for="empty-field" class="form-label" style="font-size: 22px;">人數限制</label>
                                <div class="form-icon">
                                    <input type="text" class="form-control" placeholder="請輸入有效數值" id="empty-field" v-model="activityBuild.maxPeople">
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="court" class="form-label" style="font-size: 22px;">活動種類(大項)</label>
                                <select class="select select2" id="mainCategory" aria-label="Default select example" v-model="activityBuild.categoryId">
                                    <option value="" disabled selected>請選擇活動種類</option>
                                    <option value="1">食</option>
                                    <option value="2">住</option>
                                    <option value="3">行</option>
                                    <option value="4">育</option>
                                    <option value="5">樂</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label for="court" class="form-label" style="font-size: 22px;">活動種類(小項)</label>
                                <select class="select select2" id="subCategory" aria-label="Default select example" v-model="activityBuild.categoryTypeId">
                                    <option value="" disabled selected>請選擇活動種類</option>
                                    <option value="1">水上運動</option>
                                    <option value="2">室內運動</option>
                                    <option value="3">揪團購</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label for="endterdate" class="form-label" style="font-size: 22px;">報名截止日期時間</label>
                                <div class="form-icon">
                                    <input type="text" class="form-control " placeholder="請輸入日期時間" v-model="activityBuild.joinDeadLine">
                                    <span class="cus-icon">
                                        <i class="feather-calendar icon-date"></i>
                                    </span>
                                </div>
                            </div>


                            <div class="mb-3">
                                <label for="empty-field" class="form-label" style="font-size: 22px;">活動價錢</label>
                                <div class="form-icon">
                                    <input type="text" class="form-control" placeholder="請輸入有效數值" id="empty-field" v-model="activityBuild.joinFee">
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="empty-field" class="form-label" style="font-size: 22px;">聚會描述</label>
                                <div class="form-icon">
                                    <textarea class="form-control" id="empty-field" rows="4" maxlength="300" v-model="activityBuild.activityNotes"></textarea>
                                </div>
                            </div>
                            <div class="col-md-12">

                                <div class="appoint-head coach-top">
                                    <h1 style="font-size: 22px;">上傳活動圖片</h1>
                                </div>

                                <div class="row" data-select2-id="25">
                                    <div class="col-md-12">
                                        <div class="file-upload-text">

                                            <div class="file-upload" style="position:relative ; display: inline-block; width: 300px; height: 200px ; margin-right: 20px;">
                                                <img :src="defaultPicOne" style="width:100%;height:100%;position:absolute;top:0%;left:0%;object-fit:contain">
                                                <p>請上傳活動圖片</p>
                                                <span>
                                                    <i class="feather-edit-3"></i>
                                                    <input type="file" id="file-input" v-on:change="uploadPicOne">
                                                </span>
                                            </div>

                                            <div class="file-upload" style="position:relative; display: inline-block; width: 300px; height: 200px; margin-right: 20px;">
                                                <img :src="defaultPicTwo" style="width:100%;height:100%;position:absolute;top:0%;left:0%;object-fit:contain">
                                                <p>請上傳活動圖片</p>
                                                <span>
                                                    <i class="feather-edit-3"></i>
                                                    <input type="file" id="file-input" v-on:change="uploadPicTwo">
                                                </span>
                                            </div>

                                            <div class="file-upload" style="position:relative; display: inline-block; width: 300px; height: 200px; margin-right: 20px;">
                                                <img :src="defaultPicThree" style="width:100%;height:100%;position:absolute;top:0%;left:0%;object-fit:contain">
                                                <p>請上傳活動圖片</p>
                                                <span>
                                                    <i class="feather-edit-3"></i>
                                                    <input type="file" id="file-input" v-on:change="uploadPicThree">
                                                </span>
                                            </div>

                                            <h5>請上傳一個最小尺寸為 150 * 150 像素的圖檔（JPG、PNG、SVG）</h5>
                                        </div>
                                    </div>
                                </div>




                            </div>

                        </form>
                    </section>
                </div>


            </div>
            <div class="text-center btn-row">
                <button class="btn btn-primary me-3 btn-icon" style="font-size: 22px; padding: 10px; width: 100px; justify-content: center;" v-on:click="leaderBuild">確認</button>
                <button class="btn btn-secondary btn-icon" href="/" style="font-size: 22px; padding: 10px;  width: 100px; justify-content: center;">取消 </button>
            </div>
        </div>
        <!-- /Container -->
    </div>
    <!-- /Page Content -->
    <!-- Footer -->
    <!-- /Footer -->
</div>

<!-- /Main Wrapper -->
<!-- jQuery -->
@*  <script src="~/assets/js/jquery-3.7.0.min.js"></script> *@

<!-- Select JSS -->
@* 	<script src="~/assets/plugins/select2/js/select2.min.js"></script> *@

<!-- Bootstrap DateTime Picker -->
@* 	<script src="~/assets/js/moment.min.js"></script>
 <script src="~/assets/js/bootstrap-datetimepicker.min.js"></script> *@

<!-- Custom JS -->
@*     <script src="~/assets/js/script.js"></script>
 <div class="sidebar-overlay"></div> *@



<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="~/js/jhobbyselect2component.js"></script>
<script src="~/js/taiwancity.js"></script>

<script>
    Vue.createApp({
        data() {
            return {
                defaultPicOne: "/images/NoImage.jpg",   
                defaultPicTwo: "/images/NoImage.jpg",
                defaultPicThree: "/images/NoImage.jpg",

                // 存儲所選擇的檔案
                fileOne: null,                                   
                fileTwo: null,
                fileThree:null,

                activityBuild: {
                    
                    activityName: "1",
                    activityCity: "1",
                    activityArea: "1",
                    activityLocation: "1",
                    startTime: "2024-01-05 12:30:00",
                    maxPeople: "1",
                    categoryId: "1",
                    categoryTypeId: "1",
                    joinDeadLine: "2024-01-05 12:30:30",
                    joinFee: "54",
                    activityNotes: "87",
                    memberId: "666",
                    activityStatus: "1",
                    payment: "1",
                    created: "2024-01-05 12:30:30"   
                },
            }
        },


        computed: {
            cityList() {
                return taiwanCity.map(x => {
                    return {
                        id: x.CityName,
                        text: x.CityName
                    }
                })
            },
            areaList() {
                let area = taiwanCity.filter(x => x.CityName == this.activityBuild.activeCity);
                if (area.length < 1) return [];
                return area[0].AreaList.map(x => {
                    return {
                        id: x.AreaName,
                        text: x.AreaName
                    }
                })
            }
        },


        methods: {
            uploadPicOne(e) {
                console.log(URL.createObjectURL(e.target.files[0]));
                this.fileOne = e.target.files[0];
                this.defaultPicOne = URL.createObjectURL(e.target.files[0]);
            },

            uploadPicTwo(e) {
                console.log(URL.createObjectURL(e.target.files[0]));
                this.fileTwo = e.target.files[0];
                this.defaultPicTwo = URL.createObjectURL(e.target.files[0]);
            },

            uploadPicThree(e) {
                console.log(URL.createObjectURL(e.target.files[0]));
                this.fileThree = e.target.files[0];
                this.defaultPicThree = URL.createObjectURL(e.target.files[0]);
            },

            leaderBuild() {
                var formData = new FormData();
                if (this.fileOne) formData.append('file', this.fileOne);
                if (this.fileTwo) formData.append('file', this.fileTwo);
                if (this.fileThree) formData.append('file', this.fileThree);

                formData.append('activityName', this.activityBuild.activityName);
                formData.append('activityCity', this.activityBuild.activityCity);
                formData.append('activityArea', this.activityBuild.activityArea);
                formData.append('activityLocation', this.activityBuild.activityLocation);
                formData.append('startTime', this.activityBuild.startTime);
                formData.append('maxPeople', this.activityBuild.maxPeople);
                formData.append('categoryId', this.activityBuild.categoryId);
                formData.append('categoryTypeId', this.activityBuild.categoryTypeId);
                formData.append('joinDeadLine', this.activityBuild.joinDeadLine);
                formData.append('joinFee', this.activityBuild.joinFee);
                formData.append('activityNotes', this.activityBuild.activityNotes);
                formData.append('memberId', this.activityBuild.memberId);
                formData.append('activityStatus', this.activityBuild.activityStatus);
                formData.append('payment', this.activityBuild.payment);
                formData.append('created', this.activityBuild.created);
            


                let self = this;

                fetch("/ActivityApi/LeaderCreate", {
                    method: "POST",                  
                    body: formData

                })
                    .then(r => r.json())
                    .then(d => {
                        console.log('Success', d);
                        //alert(JSON.stringify(this.activityBuild));
                        alert("建立成功,進入預覽編輯畫面");
                    })
                //alert(123);
            },
        },
    }).component('select2', select2).mount("#app");
</script>